# Agents API

<%= toc %>

## List agents

Returns a [paginated list](<%= paginated_resource_docs_url %>) of an accountâ€™s agents.

```bash
curl "https://api.buildkite.com/v1/organizations/{org.slug}/agents"
```

```json
[
  {
    "id": "0b461f65-e7be-4c80-888a-ef11d81fd971",
    "url": "https://api.buildkite.com/v1/organizations/my-great-org/agents/my-agent",
    "web_url": "https://buildkite.com/organizations/buildkite/my-great-org/agents/0b461f65-e7be-4c80-888a-ef11d81fd971",
    "name": "my-agent",
    "connection_state": "connected",
    "access_token": "e8f7846d8b138f06d828068b623edfaa431c2782b1af709288",
    "hostname": "some.server",
    "ip_address": "144.132.19.12",
    "user_agent": "buildkite-agent/2.1.0 (linux; amd64)",
    "version": "2.1.0",
    "creator": {
      "id": "2eba97bc-7cc7-427f-8feb-1008c72aa1d8",
      "name": "Keith Pitt",
      "email": "me@keithpitt.com",
      "avatar_url": "https://www.gravatar.com/avatar/e14f55d3f939977cecbf51b64ff6f861",
      "created_at": "2015-05-09T21:05:59.874Z"
    },
    "created_at": "2014-02-24T22:33:45.263Z",
    "job": {
      "id": "cd164055-9649-452b-8d8e-28fe67370a1e",
      "type": "script",
      "name": "rspec",
      "agent_query_rules": ["*"],
      "state": "passed",
      "build_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50",
      "web_url": "https://buildkite.com/my-great-org/sleeper/builds/50#cd164055-9649-452b-8d8e-28fe67370a1e",
      "log_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/log",
      "raw_log_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/log.txt",
      "artifacts_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/artifacts",
      "script_path": "sleep 1",
      "command": "sleep 1",
      "exit_status": 0,
      "artifact_paths": "*",
      "agent": null,
      "created_at": "2015-07-30T12:58:22.942Z",
      "scheduled_at": "2015-07-30T12:58:22.935Z",
      "started_at": "2015-07-30T12:58:34.000Z",
      "finished_at": "2015-07-30T12:58:37.000Z"
    },
    "last_job_finished_at": null,
    "priority": null,
    "meta_data": ["key1=val1","key2=val2"]
  }
]
```

Optional query string parameters:

<table>
<tbody>
  <tr><th><code>name</code></th><td>Filters the results by the given agent name<p class="Docs__api-param-eg"><em>Example:</em> <code>?name=ci-agent-1</code></p></td></tr>
  <tr><th><code>hostname</code></th><td>Filters the results by the given hostname<p class="Docs__api-param-eg"><em>Example:</em> <code>?hostname=ci-box-1</code></p></td></tr>
  <tr><th><code>version</code></th><td>Filters the results by the given exact version number<p class="Docs__api-param-eg"><em>Example:</em> <code>?version=2.1.0</code></p></td></tr>
</tbody>
</table>

Required scope: `read_agents`

Success response: `200 OK`

## Get an agent

```bash
curl "https://api.buildkite.com/v1/organizations/{org.slug}/agents/{id}"
```

```json
{
  "id": "0b461f65-e7be-4c80-888a-ef11d81fd971",
  "url": "https://api.buildkite.com/v1/organizations/my-great-org/agents/my-agent",
  "web_url": "https://buildkite.com/organizations/buildkite/my-great-org/agents/0b461f65-e7be-4c80-888a-ef11d81fd971",
  "name": "my-agent",
  "connection_state": "connected",
  "access_token": "e8f7846d8b138f06d828068b623edfaa431c2782b1af709288",
  "hostname": "some.server",
  "ip_address": "144.132.19.12",
  "user_agent": "buildkite-agent/2.1.0 (linux; amd64)",
  "version": "2.1.0",
  "creator": {
    "id": "2eba97bc-7cc7-427f-8feb-1008c72aa1d8",
    "name": "Keith Pitt",
    "email": "me@keithpitt.com",
    "avatar_url": "https://www.gravatar.com/avatar/e14f55d3f939977cecbf51b64ff6f861",
    "created_at": "2015-05-09T21:05:59.874Z"
  },
  "created_at": "2015-05-09T21:05:59.874Z",
  "job": {
    "id": "cd164055-9649-452b-8d8e-28fe67370a1e",
    "type": "script",
    "name": "rspec",
    "agent_query_rules": ["*"],
    "state": "passed",
    "build_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50",
    "web_url": "https://buildkite.com/my-great-org/sleeper/builds/50#cd164055-9649-452b-8d8e-28fe67370a1e",
    "log_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/log",
    "raw_log_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/log.txt",
    "artifacts_url": "https://api.buildkite.com/v1/organizations/my-great-org/pipelines/sleeper/builds/50/jobs/cd164055-9649-452b-8d8e-28fe67370a1e/artifacts",
    "script_path": "sleep 1",
    "command": "sleep 1",
    "exit_status": 0,
    "artifact_paths": "*",
    "agent": null,
    "created_at": "2015-07-30T12:58:22.942Z",
    "scheduled_at": "2015-07-30T12:58:22.935Z",
    "started_at": "2015-07-30T12:58:34.000Z",
    "finished_at": "2015-07-30T12:58:37.000Z"
  },
  "last_job_finished_at": null,
  "priority": null,
  "meta_data": ["key1=val1","key2=val2"]
}
```

Required scope: `read_agents`

Success response: `200 OK`

## Create an agent

```bash
curl -X POST "https://api.buildkite.com/v1/organizations/{org.slug}/agents" \
  -d '{
    "name" : "new-agent"
  }'
```

```json
{
  "id": "0eb53761-e0ff-496e-88dc-11277dc3134c",
  "url": "https://api.buildkite.com/v1/organizations/my-great-org/agents/new-agent",
  "web_url": "https://buildkite.com/organizations/buildkite/my-great-org/agents/0eb53761-e0ff-496e-88dc-11277dc3134c",
  "name": "new-agent",
  "connection_state": "pending",
  "access_token": "e8f7846d8b138f06d828068b623edfaa431c2782b1af709288",
  "hostname": null,
  "user_agent": null,
  "creator": {
    "id": "2eba97bc-7cc7-427f-8feb-1008c72aa1d8",
    "name": "Keith Pitt",
    "email": "me@keithpitt.com",
    "avatar_url": "https://www.gravatar.com/avatar/e14f55d3f939977cecbf51b64ff6f861",
    "created_at": "2015-05-09T21:05:59.874Z"
  },
  "created_at": "2015-05-09T21:05:59.874Z",
  "job": null,
  "last_job_finished_at": null,
  "priority": null,
  "meta_data": []
}
```

Required properties:

<table>
<tbody>
  <tr><th><code>name</code></th><td>The name of the agent.<p class="Docs__api-param-eg"><em>Example:</em> <code>"new-agent"</code></p></td></tr>
</tbody>
</table>

Required scope: `write_agents`

Success response: `201 Created`

## Stop an agent

Instruct an agent to stop accepting new build jobs and shut itself down.

```bash
curl -X PUT "https://api.buildkite.com/v1/organizations/{org.slug}/agents/{id}/stop"
```

Optional properties:

<table>
<tbody>
  <tr><th><code>force</code></th><td>If the agent is currently processing a job, the job and the build will be canceled.<p class="Docs__api-param-eg"><em>Default:</em> <code>true</code></p></td></tr>
</tbody>
</table>

Required scope: `write_agents`

Success response: `204 No Content`

Error responses:

<table>
<tbody>
  <tr><th><code>400 Bad Request</code></th><td><code>{ "message": "Can only stop connected agents" }</code></td></tr>
</tbody>
</table>

## Delete an agent

<div class="Docs__note">
  <p>Note: This API endpoint can only delete legacy agents and should be considered deprecated.</p>
</div>

Deletes an agent from Buildkite. If the agent is running, the process will continue to run, but will not be able to communicate with the Agent API anymore.

```bash
curl -X DELETE "https://api.buildkite.com/v1/organizations/{org.slug}/agents/{id}"
```

Required scope: `write_agents`

Success response: `204 No Content`
