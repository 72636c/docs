# Bitbucket

Connecting to Bitbucket's build status API allows repository events to trigger Buildkite builds. New builds can be triggered by events like pushing commits or updating pull requests. After the build completes in Buildkite, the status icon in Bitbucket will update to reflect the outcome. 

To enable builds in Buildkite for your repository, set up a Bitbucket webhook.

<%= toc %>

## Setting up a Bitbucket webhook

This webhook will be triggered by the repository events that you specify, and will hit your unique Buildkite API endpoint to create a Buildkite build.

1. Visit your Bitbucket repository's 'Webhooks Settings' page
1. Click the 'Add Webhook' button and enter your Buildkite organization and pipeline name, as well as your unique Buildkite webhook URL
1. From the list of triggers select: 
    * Repository:
        - Push
    * Pull Request:
        - Created
        - Updated
        - Approved
        - Approval Removed
        - Merged
        - Declined 

Once you've filled it out, the form should look like this:
<%= image "webhook-form.png", width: 930/2, height: 1578/2, alt: "Screenshot of a completed Bitbucket webhook form" %>

Click the Save button, and the webhook will be created. Set up a Buildkite pipeline using this repository's url, and the repository events that you selected will trigger the creation of Buildkite builds ðŸŽ‰

When you set up a new Buildkite pipeline with a Bitbucket repository, we'll display these instructions again, populated with your unique account and pipeline details. 

## Connecting Buildkite to Bitbucket

Connecting Bitbucket as an app in Buildkite will allow Buildkite limited access to your Bitbucket account. Enabling this will allow Bitbucket's build status icons to reflect the state of your Buildkite builds. 

<%= image "build-status.png", width: 1200/2, height: 534/2, alt: "Screenshot of the Bitbucket builds popup" %>

This step is optional - not adding Bitbucket as a connected app will not affect your ability to trigger Buildkite builds from your Bitbucket repository.  

In Buildkite, go to Personal Settings > Connected Apps > Bitbucket and click Connect
<%= image "personal-settings.png", width: 1938/2, height: 382/2, alt: "Screenshot of the Buildkite Connected Apps screen" %>

You can edit the Bitbucket settings for specific pipelines from the settings page of any pipeline using a Bitbucket repository. 

<%= image "bitbucket-settings.png", width: 1938/2, height: 942/2, alt: "Screenshot of the Buildkite Bitbucket settings" %>