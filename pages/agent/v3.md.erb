# The Buildkite Agent

The buildkite agent is a small, reliable and cross-platform build runner that makes it easy to run automated builds on your own infrastructure. Its main responsibilities are polling buildkite.com for work, running build jobs, reporting back the status code and output log of the job, and uploading the job's artifacts.

## How it Works

The agent works by polling Buildkite’s agent API over HTTPS. There is no need to forward ports or provide incoming firewall access, and the agents can be run across any number of machines and networks.

<svg alt="Diagram showing agent to agent API communication" width="730" height="570" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><rect id="i" x="11" y="11" width="102" height="65" rx="8"/><rect id="j" x="6" y="6" width="102" height="65" rx="8"/><rect id="k" width="102" height="65" rx="8"/><rect id="l" width="75" height="48" rx="8"/><path d="M0 8.007C0 3.585 3.575 0 7.996 0h165.008C177.42 0 181 3.588 181 8.007v31.986c0 4.422-3.575 8.007-7.996 8.007H7.996C3.58 48 0 44.412 0 39.993V8.007z" id="a"/><mask id="m" x="0" y="0" width="181" height="48" fill="#fff"><use xlink:href="#a"/></mask><path d="M0 8.007C0 3.585 3.575 0 7.997 0h178.006C190.42 0 194 3.588 194 8.007v31.986c0 4.422-3.575 8.007-7.997 8.007H7.997C3.58 48 0 44.412 0 39.993V8.007z" id="b"/><mask id="n" x="0" y="0" width="194" height="48" fill="#fff"><use xlink:href="#b"/></mask><path d="M0 8.007C0 3.585 3.576 0 7.99 0h119.02c4.412 0 7.99 3.588 7.99 8.007v31.986c0 4.422-3.576 8.007-7.99 8.007H7.99C3.579 48 0 44.412 0 39.993V8.007z" id="c"/><mask id="o" x="0" y="0" width="135" height="48" fill="#fff"><use xlink:href="#c"/></mask><path d="M0 8.007C0 3.585 3.575 0 7.996 0h165.008C177.42 0 181 3.588 181 8.007v31.986c0 4.422-3.575 8.007-7.996 8.007H7.996C3.58 48 0 44.412 0 39.993V8.007z" id="d"/><mask id="p" x="0" y="0" width="181" height="48" fill="#fff"><use xlink:href="#d"/></mask><path d="M0 8.007C0 3.585 3.575 0 7.996 0h165.008C177.42 0 181 3.588 181 8.007v31.986c0 4.422-3.575 8.007-7.996 8.007H7.996C3.58 48 0 44.412 0 39.993V8.007z" id="e"/><mask id="q" x="0" y="0" width="181" height="48" fill="#fff"><use xlink:href="#e"/></mask><path d="M0 8.007C0 3.585 3.575 0 7.997 0h178.006C190.42 0 194 3.588 194 8.007v31.986c0 4.422-3.575 8.007-7.997 8.007H7.997C3.58 48 0 44.412 0 39.993V8.007z" id="f"/><mask id="r" x="0" y="0" width="194" height="48" fill="#fff"><use xlink:href="#f"/></mask><path d="M14 8.007C14 3.585 17.576 0 21.99 0h119.02c4.412 0 7.99 3.588 7.99 8.007v31.986c0 4.422-3.576 8.007-7.99 8.007H21.99C17.579 48 14 44.412 14 39.993V8.007z" id="g"/><mask id="s" x="0" y="0" width="135" height="48" fill="#fff"><use xlink:href="#g"/></mask><path d="M0 8.007C0 3.585 3.585 0 7.998 0h151.004C163.419 0 167 3.588 167 8.007v31.986c0 4.422-3.585 8.007-7.998 8.007H7.998C3.581 48 0 44.412 0 39.993V8.007z" id="h"/><mask id="t" x="0" y="0" width="167" height="48" fill="#fff"><use xlink:href="#h"/></mask><rect id="u" width="75" height="48" rx="8"/><rect id="v" x="11" y="11" width="102" height="65" rx="8"/><rect id="w" x="6" y="6" width="102" height="65" rx="8"/><rect id="x" width="102" height="65" rx="8"/><rect id="y" x="11" y="11" width="102" height="65" rx="8"/><rect id="z" x="6" y="6" width="102" height="65" rx="8"/><rect id="A" width="102" height="65" rx="8"/></defs><g fill="none" fill-rule="evenodd"><path d="M-.5 274.5h732.154" stroke="#DCDCDC" stroke-linecap="square" stroke-dasharray="10"/><text font-family="BK-Circular" font-size="18" font-weight="400" fill="#666"><tspan x="618" y="305">On-Premise</tspan></text><text font-family="BK-Circular" font-size="18" font-weight="400" fill="#666"><tspan x="581" y="32">Hosted Platform</tspan></text><g transform="translate(163 383)"><use fill="#FFF" xlink:href="#i"/><rect stroke="#979797" x="11.5" y="11.5" width="101" height="64" rx="8"/></g><g transform="translate(163 383)"><use fill="#FFF" xlink:href="#j"/><rect stroke="#979797" x="6.5" y="6.5" width="101" height="64" rx="8"/></g><g transform="translate(163 383)"><use fill="#FFF" xlink:href="#k"/><rect stroke="#979797" x=".5" y=".5" width="101" height="64" rx="8"/></g><text font-family="BK-Circular" font-size="18" font-weight="bold" letter-spacing="1.125" fill="#2ACE69" transform="translate(163 383)"><tspan x="18.311" y="39">AGEN</tspan> <tspan x="73.535" y="39" letter-spacing="1.013">T</tspan></text><g transform="translate(95 312)"><use fill="#FFF" xlink:href="#l"/><rect stroke="#979797" x=".5" y=".5" width="74" height="47" rx="8"/></g><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#2ACE69" transform="translate(95 312)"><tspan x="14.157" y="30">AGEN</tspan> <tspan x="54.041" y="30" letter-spacing=".754">T</tspan></text><g transform="translate(56 490)"><use stroke="#979797" mask="url(#m)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#a"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="20.434" y="30">YOUR SOURCE CODE</tspan></text></g><g transform="translate(275 492)"><use stroke="#979797" mask="url(#n)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#b"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="15.187" y="30">YOUR DEPLOY SECRETS</tspan></text></g><g transform="translate(65 67)"><use stroke="#979797" mask="url(#o)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#c"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="26.595" y="30">WEBHOOKS</tspan></text></g><g transform="translate(264 43)"><use stroke="#979797" mask="url(#p)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#d"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="19.539" y="30">SCM INTEGRATIONS</tspan></text></g><g transform="translate(39 185)"><use stroke="#979797" mask="url(#q)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#e"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="16.084" y="30">CHAT INTEGRATIONS</tspan></text></g><g transform="translate(494 185)"><use stroke="#979797" mask="url(#r)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#f"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="19.984" y="30">REST &amp; GRAPHQL APIs</tspan></text></g><g transform="translate(507 67)"><use stroke="#979797" mask="url(#s)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#g"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="26.849" y="30">WEB INTERFACE</tspan></text></g><g transform="translate(507 490)"><use stroke="#979797" mask="url(#t)" stroke-width="2" fill="#FFF" stroke-dasharray="3" xlink:href="#h"/><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#000"><tspan x="13.482" y="30">INTERNAL SYSTEMS</tspan></text></g><g transform="translate(526 312)"><use fill="#FFF" xlink:href="#u"/><rect stroke="#979797" x=".5" y=".5" width="74" height="47" rx="8"/></g><text font-family="BK-Circular" font-size="13" font-weight="bold" letter-spacing=".813" fill="#2ACE69" transform="translate(526 312)"><tspan x="14.157" y="30">AGEN</tspan> <tspan x="54.041" y="30" letter-spacing=".754">T</tspan></text><g transform="translate(298 383)"><use fill="#FFF" xlink:href="#v"/><rect stroke="#979797" x="11.5" y="11.5" width="101" height="64" rx="8"/></g><g transform="translate(298 383)"><use fill="#FFF" xlink:href="#w"/><rect stroke="#979797" x="6.5" y="6.5" width="101" height="64" rx="8"/></g><g transform="translate(298 383)"><use fill="#FFF" xlink:href="#x"/><rect stroke="#979797" x=".5" y=".5" width="101" height="64" rx="8"/></g><text font-family="BK-Circular" font-size="18" font-weight="bold" letter-spacing="1.125" fill="#2ACE69" transform="translate(298 383)"><tspan x="18.311" y="39">AGEN</tspan> <tspan x="73.535" y="39" letter-spacing="1.013">T</tspan></text><g transform="translate(228 113)"><rect stroke="#979797" x=".5" y=".5" width="249" height="64" rx="8"/><text font-family="BK-Circular" font-size="18" font-weight="bold" letter-spacing="1.125" fill="#2ACE69"><tspan x="18.98" y="39">BUILDKITE AGENT API</tspan></text></g><g transform="translate(430 383)"><use fill="#FFF" xlink:href="#y"/><rect stroke="#979797" x="11.5" y="11.5" width="101" height="64" rx="8"/></g><g transform="translate(430 383)"><use fill="#FFF" xlink:href="#z"/><rect stroke="#979797" x="6.5" y="6.5" width="101" height="64" rx="8"/></g><g transform="translate(430 383)"><use fill="#FFF" xlink:href="#A"/><rect stroke="#979797" x=".5" y=".5" width="101" height="64" rx="8"/></g><text font-family="BK-Circular" font-size="18" font-weight="bold" letter-spacing="1.125" fill="#2ACE69" transform="translate(430 383)"><tspan x="18.311" y="39">AGEN</tspan> <tspan x="73.535" y="39" letter-spacing="1.013">T</tspan></text><path d="M353.5 185.5l166 119M519.5 304.5l-7.03-8.73-3.495 4.876L519.5 304.5zM353.5 185.5l116 183M469.5 368.5l-3.248-10.728-5.068 3.212 8.316 7.516zM353.5 185.5l-8 181M345.5 366.5l3.474-10.657-5.994-.265 2.52 10.922zM353.5 185.5l-131 184M222.5 369.5l8.708-7.058-4.888-3.48-3.82 10.538zM353.5 185.5l-173 118M180.5 303.5l10.613-3.607-3.381-4.957-7.232 8.564z" stroke="#B4B4B4" fill="#B4B4B4" stroke-linecap="square"/></g></svg>

The agent starts by registering itself with Buildkite, and once registered it’s placed into your organization’s agents pool. The agent periodically polls Buildkite looking for new work, waiting to accept an available job.

After accepting a build job the agent will execute the command, streaming back the build script’s output and then posting the final exit status.

Whilst the job is running you can use the `buildkite-agent meta-data` command to set and get build-wide meta-data, and `buildkite-agent artifact` for fetching and retrieving binary build-wide artifacts. These two commands allow you to have completely isolated build jobs (similar to a 12 factor web application) but have easy access to shared state and data storage across any number of machines and networks.

## Installation

The agent can be easily installed onto almost any system large or tiny, and we have installers to make it easy to run and manage your agents. See the [installation instructions](/docs/agent/v3/installation) to get started.

## Usage

<div class="highlight">
  <pre class="highlight shell"><code>$ buildkite-agent --help
Usage:

  buildkite-agent <command> [arguments...]

Available commands are:

  <a href="cli-start">start</a>      Starts a Buildkite agent
  <a href="cli-annotate">annotate</a>   Annotate the build page within the Buildkite UI with text from within a Buildkite job
  <a href="cli-artifact">artifact</a>   Upload/download artifacts from Buildkite jobs
  <a href="cli-meta-data">meta-data</a>  Get/set data from Buildkite jobs
  <a href="cli-pipeline">pipeline</a>   Make changes to the pipeline of the currently running build
  <a href="cli-bootstrap">bootstrap</a>  Run a Buildkite job locally
  help       Shows a list of commands or help for one command

Use "buildkite-agent <command> --help" for more information about a command.
</code></pre></div>

To start an agent you’ll need your organization’s agent token from the Agents page of your Buildkite dashboard. You pass the token to the agent via an environment variable or command line flag, and it will register itself with Buildkite and wait to accept jobs.

## Configuration

The agent has a standard configuration file format on all systems to set meta-data, priority, etc. See the [configuration documentation](/docs/agent/v3/configuration) for more details.

## Customising with Hooks

The agent’s behaviour can be customized using hooks, which are just shell scripts that exist on your build machines or in each pipeline’s code repository. Hooks can be used to set up secrets as well as overriding default behavior. See the [hooks](/docs/agent/v3/hooks) documentation for full details.

## Signal Handling

When a build job is canceled the agent will send the build job process a `SIGTERM` signal to allow it to gracefully exit. If the process does not exit within 10 seconds it will be forcefully terminated with a `SIGKILL` signal.
